<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cam test</title>
</head>
<body>
    <video autoplay></video>
    <button id="capture-btn">Capture</button>
    <button id="change-cam-btn">Change camera</button>
    <canvas style="display:none;"></canvas>
    <img src="">
    <script>
        const video = document.querySelector('video');
        const captureBtn = document.querySelector('#capture-btn');
        const changeCamBtn = document.querySelector('#change-cam-btn');
        const canvas = document.querySelector('canvas');
        const img = document.querySelector('img');

        let front = false;
        let constraints = { video: { facingMode: { exact: camMode() } } };
        let videoStream;

        function camMode() {
            if (front) {
                return 'user'
            } else {
                return 'environment'
            }
        }

        function displayVideoFeed() {
            navigator.mediaDevices.getUserMedia(constraints)
                .then((stream) => {
                    videoStream = stream;
                    video.srcObject = stream;
            })
        }

        function stopAllVideoTracks() {
            if(videoStream && videoStream.getVideoTracks().length > 0) {
                videoStream.getVideoTracks().forEach((track) => {
                    track.stop();
                })
            }
        }

        displayVideoFeed();

        captureBtn.addEventListener('click', () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            // Other browsers will fall back to image/png
            img.src = canvas.toDataURL('image/webp');
        })

        changeCamBtn.addEventListener('click', () => {
            front = !front;
            stopAllVideoTracks();
            displayVideoFeed();
            console.log(front);
            console.log(camMode());
            console.log(constraints);
        })

    </script>
</body>
</html>